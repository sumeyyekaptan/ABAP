*&---------------------------------------------------------------------*
*& Report  ZMM_R_SATICI_PARTI_LISTESI
*&
*&---------------------------------------------------------------------*
*&
*&
*&---------------------------------------------------------------------*

REPORT ZMM_R_SATICI_PARTI_LISTESI.

TABLES : MCH1, " PARTİ
         MSEG.

TYPE-POOLS: SLIS.

DATA: FIELDCATALOG TYPE SLIS_T_FIELDCAT_ALV WITH HEADER LINE.

DATA: IT_FIELDCAT  TYPE LVC_T_FCAT,
      WA_FIELDCAT  TYPE LVC_S_FCAT,
      GD_TAB_GROUP TYPE SLIS_T_SP_GROUP_ALV,
      GD_LAYOUT    TYPE LVC_S_LAYO,
      GD_REPID     LIKE SY-REPID.

***************************Referans Parti Kontrol****************************

DATA : BEGIN OF GT_SATICI OCCURS 0 ,
         MBLNR LIKE MSEG-MBLNR,                " İRSALİYE BELGE NUMARASI
         BLDAT LIKE MKPF-BLDAT,                " BELGE TARİHİ
         LIFNR LIKE MSEG-LIFNR,                " TEDARİKÇİ KODU
         NAME1 LIKE LFA1-NAME1,                " TEDARİKÇİ ADI
         MATNR LIKE MARA-MATNR,                " MALZEME KODU
         MAKTX LIKE MAKT-MAKTX,                " MALZEME ADI
         MENGE LIKE MSEG-MENGE,                " MİKTAR
         CHARG LIKE MSEG-CHARG,                " SAMPA PARTİ NO
         LICHA LIKE MCHA-LICHA,                " REFERANS PARTİ
         ZEILE LIKE MSEG-ZEILE,                " KALEM NO
       END OF GT_SATICI.

SELECTION-SCREEN BEGIN OF BLOCK BLOCK1 WITH FRAME
                                                 TITLE TEXT-001.
SELECT-OPTIONS: PMBLNR FOR  MSEG-MBLNR.                      "İRSALİYE BELGE NUMARASI
SELECT-OPTIONS: PLICHA FOR  MCH1-LICHA.                      "REFERANS PARTİ

SELECTION-SCREEN END OF BLOCK BLOCK1.

PERFORM GET_DATA.
PERFORM BUILD_FIELDCATALOG.
PERFORM BUILD_LAYOUT.
PERFORM DISPLAY_ALV_REPORT.

FORM GET_DATA.

    SELECT MSG~MBLNR
           MKP~BLDAT
           MSG~MATNR
           MKT~MAKTX
           MSG~MENGE
           MSG~CHARG
           MC1~LICHA
           MC1~LIFNR
           LFA~NAME1
           MSG~ZEILE
      FROM MSEG                  AS MSG
INNER JOIN MCH1                  AS MC1 ON MC1~MATNR = MSG~MATNR
                                       AND MC1~CHARG = MSG~CHARG
INNER JOIN MKPF                  AS MKP ON MKP~MBLNR = MSG~MBLNR
      LEFT JOIN MAKT             AS MKT ON MKT~MATNR = MSG~MATNR
       AND MKT~SPRAS = 'TR'
 LEFT JOIN LFA1                  AS LFA ON MC1~LIFNR = LFA~LIFNR
      INTO CORRESPONDING FIELDS OF TABLE GT_SATICI
     WHERE MSG~WERKS = '1100'          "ÜRETİM YERİ SAMPA OLANLAR
       AND MSG~BWART = 101             "MALZEME GİRİŞ BELGELERİ
       AND MC1~LICHA IN PLICHA
       AND MSG~MBLNR IN PMBLNR
  ORDER BY MSG~MBLNR MSG~ZEILE.
ENDFORM.

FORM BUILD_FIELDCATALOG .

  WA_FIELDCAT-FIELDNAME   = 'MBLNR'.
  WA_FIELDCAT-SCRTEXT_M   = TEXT-002."'İRSALİYE BELGE NUMARASI'.
  FIELDCATALOG-OUTPUTLEN   = 5.
  WA_FIELDCAT-COL_POS     = 1.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR  WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME   = 'ZEILE'.
  WA_FIELDCAT-SCRTEXT_M   = TEXT-011."'BELGE TARİHİ'."
  FIELDCATALOG-OUTPUTLEN   = 5.
  WA_FIELDCAT-COL_POS     = 2.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR  WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME   = 'BLDAT'.
  WA_FIELDCAT-SCRTEXT_M   = TEXT-003."'BELGE TARİHİ'."
  FIELDCATALOG-OUTPUTLEN   = 5.
  WA_FIELDCAT-COL_POS     = 3.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR  WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME   = 'LIFNR'.
  WA_FIELDCAT-SCRTEXT_M   = TEXT-004."'TEDARİKÇİ KODU'."
  FIELDCATALOG-OUTPUTLEN   = 5.
  WA_FIELDCAT-COL_POS     = 4.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR  WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME   = 'NAME1'.
  WA_FIELDCAT-SCRTEXT_M   = TEXT-005."'TEDARİKÇİ ADI'."
  FIELDCATALOG-OUTPUTLEN   = 5.
  WA_FIELDCAT-COL_POS     = 5.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR  WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME   = 'MATNR'.
  WA_FIELDCAT-SCRTEXT_M   = TEXT-006."'MALZEME KODU'."
  FIELDCATALOG-OUTPUTLEN   = 5.
  WA_FIELDCAT-COL_POS     = 6.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR  WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME   = 'MAKTX'.
  WA_FIELDCAT-SCRTEXT_M   = TEXT-007."'MALZEME ADI'."
  FIELDCATALOG-OUTPUTLEN   = 5.
  WA_FIELDCAT-COL_POS     = 7.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR  WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME   = 'MENGE'.
  WA_FIELDCAT-SCRTEXT_M   = TEXT-008."'MİKTAR'.
  FIELDCATALOG-OUTPUTLEN   = 5.
  WA_FIELDCAT-COL_POS     = 8.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR  WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME   = 'CHARG'.
  WA_FIELDCAT-SCRTEXT_M   = TEXT-009."'SAMPA PARTİ NO'."
  FIELDCATALOG-OUTPUTLEN   = 5.
  WA_FIELDCAT-COL_POS     = 9.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR  WA_FIELDCAT.

  WA_FIELDCAT-FIELDNAME   = 'LICHA'.
  WA_FIELDCAT-SCRTEXT_M   = TEXT-010."'REFERANS PARTİ'.
  FIELDCATALOG-OUTPUTLEN   = 5.
  WA_FIELDCAT-COL_POS     = 10.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR  WA_FIELDCAT.

ENDFORM.                    " BUILD_FIELDCATALOG

FORM BUILD_LAYOUT .

  GD_LAYOUT-STYLEFNAME = 'FIELD_STYLE'.
  GD_LAYOUT-ZEBRA      = 'X'.
  GD_LAYOUT-CWIDTH_OPT = 'X'.

ENDFORM.                    " BUILD_LAYOUT

FORM DISPLAY_ALV_REPORT .
  GD_REPID = SY-REPID.

  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY_LVC'
    EXPORTING
      I_CALLBACK_PROGRAM      = GD_REPID
      I_CALLBACK_USER_COMMAND = 'USER_COMMAND'
      IS_LAYOUT_LVC           = GD_LAYOUT
      IT_FIELDCAT_LVC         = IT_FIELDCAT
      I_SAVE                  = 'X'
    TABLES
      T_OUTTAB                = GT_SATICI
    EXCEPTIONS
      PROGRAM_ERROR           = 1
      OTHERS                  = 2.
  IF SY-SUBRC <> 0.

  ENDIF.
ENDFORM.                    " DISPLAY_ALV_REPORT

***********************İRSALİYE NUMARASI İÇİN SEARCH HELP********************
*
*DATA : BEGIN OF VALUES_TAB OCCURS 0 ,
*         MBLNR LIKE MSEG-MBLNR,            "İRSALİYE NUMARASI
*       END OF VALUES_TAB.
*
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR  : PMBLNR-LOW.
*  PERFORM IRSALIYE_NO_SEARCHHELP.
*
*INITIALIZATION.
*  PERFORM INIT_SELECTION.
*
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR  : PMBLNR-HIGH.
*  PERFORM IRSALIYE_NO_SEARCHHELP.
*
*INITIALIZATION.
*  PERFORM INIT_SELECTION.
*
*FORM IRSALIYE_NO_SEARCHHELP.
*
*  CALL FUNCTION 'F4IF_INT_TABLE_VALUE_REQUEST'
*    EXPORTING
*      RETFIELD        = 'MBLNR'
*      DYNPPROG        = SY-CPROG
*      DYNPNR          = SY-DYNNR
*      DYNPROFIELD     = 'PMBLNR'
*      VALUE_ORG       = 'S'
*      WINDOW_TITLE    = 'İRSALİYE NUMARASI'
*    TABLES
*      VALUE_TAB       = VALUES_TAB[]
*    EXCEPTIONS
*      PARAMETER_ERROR = 1
*      NO_VALUES_FOUND = 2
*      OTHERS          = 3.
*  IF SY-SUBRC <> 0.
*    MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*    WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
*  ENDIF.
*
*ENDFORM.
*
*FORM INIT_SELECTION .
*  SELECT  MBLNR
*  FROM  MSEG   "MKPF
*  INTO  CORRESPONDING FIELDS OF TABLE VALUES_TAB
*    WHERE BWART = 101.
*  SORT VALUES_TAB BY MBLNR ASCENDING.
*ENDFORM.
